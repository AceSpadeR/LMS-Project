@page
@model LMS.Pages.Account.ProfileModel
@{
    ViewData["Title"] = "Profile";
}


<form id="profile-form" method="post">
    <div class="row">
        <div class="col-2">
            <h1>Profile</h1>
        </div>
        <div class="col-4">
            <button class="btn btn-primary me-2" asp-page="./ProfilePic" asp-route-Id="@Model.LoginUser?.Id">
                <i class="bi bi-image me-2"></i> Change Image
            </button>
        </div>
        <div class="col-6 text-end">
            <div class="form-group row">
                <div class="col-sm-12">
                    <button type="button" onclick="enableEditing()" class="btn btn-primary me-2">
                        <i class="bi bi-pencil-square me-2"></i> Edit Profile
                    </button>
                    <button id="form-save" type="submit" class="btn btn-success" disabled>
                        <i class="bi bi-check-lg me-2"></i> Save
                    </button>
                </div>
            </div>
        </div>
    </div>
    <hr />

    <div asp-validation-summary="ModelOnly" class="text-danger"></div>
    <input asp-for="LoginUser.Role" type="hidden">
    <input asp-for="LoginUser.Password" type="hidden">
    <input asp-for="LoginUser.ConfirmPassword" type="hidden">

    <div class="form-group row">
        <label asp-for="LoginUser.FirstName" class="col-sm-2 col-form-label">First Name: <span class="text-danger">*</span></label>
        <div class="col-sm-10">
            <input type="text" class="form-control mb-3" asp-for="LoginUser.FirstName" value="@Model.LoginUser.FirstName" required disabled />
            <i><span asp-validation-for="LoginUser.FirstName" class="text-danger small"></span></i>
        </div>
    </div>

    <div class="form-group row">
        <label asp-for="LoginUser.LastName" class="col-sm-2 col-form-label">Last Name: <span class="text-danger">*</span></label>
        <div class="col-sm-10">
            <input type="text" class="form-control mb-3" asp-for="LoginUser.LastName" value="@Model.LoginUser.LastName" required disabled />
            <i><span asp-validation-for="LoginUser.LastName" class="text-danger small"></span></i>
        </div>
	</div>

    <div class="form-group row">
        <label asp-for="LoginUser.Email" class="col-sm-2 col-form-label">Email: <span class="text-danger">*</span></label>
        <div class="col-sm-10">
            <input type="email" class="form-control mb-3" asp-for="LoginUser.Email" value="@Model.LoginUser.Email" required disabled />
            <i><span asp-validation-for="LoginUser.Email" class="text-danger small"></span></i>
        </div>
    </div>

    <div class="form-group row">
        <label asp-for="LoginUser.BirthDate" class="col-sm-2 col-form-label">Birth Date: <span class="text-danger">*</span></label>
        <div class="col-sm-10">
            <input type="date" class="form-control mb-3" asp-for="LoginUser.BirthDate" value="@Model.LoginUser.BirthDate.ToString("yyyy-MM-dd")" data-val-minimumage="Must be at least 16 years old." data-val-minimumage-minage="16" disabled />
            <i><span asp-validation-for="LoginUser.BirthDate" class="text-danger small"></span></i>
        </div>
    </div>

    <div class="form-group row">
        <label asp-for="LoginUser.Address1" class="col-sm-2 col-form-label">Address 1:</label>
        <div class="col-sm-10">
            <input type="text" class="form-control mb-3" asp-for="LoginUser.Address1" value="@Model.LoginUser.Address1" disabled />
            <i><span asp-validation-for="LoginUser.Address1" class="text-danger small"></span></i>
        </div>
    </div>

    <div class="form-group row">
        <label asp-for="LoginUser.Address2" class="col-sm-2 col-form-label">Address 2:</label>
        <div class="col-sm-10">
            <input type="text" class="form-control mb-3" asp-for="LoginUser.Address2" value="@Model.LoginUser.Address2" disabled />
            <i><span asp-validation-for="LoginUser.Address2" class="text-danger small"></span></i>
        </div>
    </div>

    <div class="form-group row">
        <label asp-for="LoginUser.City" class="col-sm-2 col-form-label">City:</label>
        <div class="col-sm-10">
            <input type="text" class="form-control mb-3" asp-for="LoginUser.City" value="@Model.LoginUser.City" disabled />
            <i><span asp-validation-for="LoginUser.City" class="text-danger small"></span></i>
        </div>
    </div>

    <div class="form-group row">
        <label asp-for="LoginUser.State" class="col-sm-2 col-form-label">State:</label>
        <div class="col-sm-10">
            <input type="text" class="form-control mb-3" asp-for="LoginUser.State" value="@Model.LoginUser.State" disabled />
            <i><span asp-validation-for="LoginUser.State" class="text-danger small"></span></i>
        </div>
    </div>

    <div class="form-group row">
        <label asp-for="LoginUser.ZipCode" class="col-sm-2 col-form-label">Zip:</label>
        <div class="col-sm-10">
            <input type="text" class="form-control mb-3" asp-for="LoginUser.ZipCode" value="@Model.LoginUser.ZipCode" disabled />
            <i><span asp-validation-for="LoginUser.ZipCode" class="text-danger small"></span></i>
        </div>
    </div>

    <div class="form-group row">
        <label asp-for="LoginUser.Phone" class="col-sm-2 col-form-label">Phone:</label>
        <div class="col-sm-10">
            <input type="tel" class="form-control mb-3" asp-for="LoginUser.Phone" value="@Model.LoginUser.Phone" disabled />
            <i><span asp-validation-for="LoginUser.Phone" class="text-danger small"></span></i>
        </div>
    </div>

    <div class="form-group row">
        <label asp-for="LoginUser.Link1" class="col-sm-2 col-form-label">Link 1:</label>
        <div class="col-sm-10">
            <input type="url" class="form-control mb-3 link-input" asp-for="LoginUser.Link1" value="@Model.LoginUser.Link1" disabled style="display: none;" />
            <a href="@Model.LoginUser.Link1" class="form-control mb-3 link-anchor" target="_blank">@Model.LoginUser.Link1</a>
            <i><span asp-validation-for="LoginUser.Link1" class="text-danger small"></span></i>
        </div>
    </div>

    <div class="form-group row">
        <label asp-for="LoginUser.Link2" class="col-sm-2 col-form-label">Link 2:</label>
        <div class="col-sm-10">
            <input type="url" class="form-control mb-3 link-input" asp-for="LoginUser.Link2" value="@Model.LoginUser.Link2" disabled style="display: none;" />
            <a href="@Model.LoginUser.Link2" class="form-control mb-3 link-anchor" target="_blank">@Model.LoginUser.Link2</a>
            <i><span asp-validation-for="LoginUser.Link2" class="text-danger small"></span></i>
        </div>
    </div>

    <div class="form-group row">
        <label asp-for="LoginUser.Link3" class="col-sm-2 col-form-label">Link 3:</label>
        <div class="col-sm-10">
            <input type="url" class="form-control mb-3 link-input" asp-for="LoginUser.Link3" value="@Model.LoginUser.Link3" disabled style="display: none;" />
            <a href="@Model.LoginUser.Link3" class="form-control link-anchor" target="_blank">@Model.LoginUser.Link3</a>
            <i><span asp-validation-for="LoginUser.Link3" class="text-danger small"></span></i>
        </div>
    </div>
</form>

<hr />

<form class="mt-3" method="post" asp-page-handler="Delete">
    <button type="submit" class="btn btn-danger">
        <i class="bi bi-trash-fill me-2"></i> Delete Account
    </button>
</form>



@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script>
        function enableEditing() {
            var form = document.getElementById("profile-form")
            var elements = form.getElementsByClassName("form-control")
            var saveBtn = document.getElementById("form-save")

            for (var i = 0; i < elements.length; i++) {
                elements[i].disabled = false;

                elements[i].focus();
                elements[i].blur();

                if (elements[i].name === 'LoginUser.Phone') {
                    elements[i].addEventListener('input', function () {
                        // Trigger your custom phone validation function here if needed
                        var errorMessage = validatePhone(this.value);
                        var validationElement = document.querySelector('[data-valmsg-for="' + this.name + '"]');
                        if (validationElement) {
                            validationElement.innerHTML = errorMessage;
                        }
                    });
                }
            }
            saveBtn.disabled = false;
            toggleLinkInputVisibility(true);
        }

        function toggleLinkInputVisibility(showInputFields) {
            var inputs = document.querySelectorAll('.link-input');
            var anchors = document.querySelectorAll('.link-anchor');

            if (showInputFields) {
                inputs.forEach(function (input) {
                    input.style.display = 'block';
                });
                anchors.forEach(function (anchor) {
                    anchor.style.display = 'none';
                });
            } else {
                inputs.forEach(function (input) {
                    input.style.display = 'none';
                });
                anchors.forEach(function (anchor) {
                    anchor.style.display = 'inline-block'; // or 'inline-block' depending on your layout
                });
            }
        }

        function validatePhone(phone) {
            // If the phone field is empty, no validation message is needed
            if (!phone.trim()) {
                return '';
            }
            // Regular expression for North American phone numbers (XXX-XXX-XXXX)
            var phoneRegex = /^\d{3}-\d{3}-\d{4}$/;

            if (!phoneRegex.test(phone)) {
                return 'Invalid phone number format. Please use XXX-XXX-XXXX.';
            }

            // If the phone number is valid, return an empty string
            return '';
        }
    </script>
}